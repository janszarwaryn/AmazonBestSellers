<div class="products-container">
  <p-toast></p-toast>

  <div class="header">
    <h1>Amazon Bestsellers</h1>
  </div>

  @if (errorMessage()) {
    <p-message severity="error" [text]="errorMessage()!" class="error-message"></p-message>
  }

  @if (loading()) {
    <div class="products-grid">
      @for (item of [1, 2, 3, 4, 5, 6]; track item) {
        <p-card class="product-card">
          <p-skeleton width="100%" height="200px"></p-skeleton>
          <p-skeleton width="100%" height="1.5rem" styleClass="mt-2"></p-skeleton>
          <p-skeleton width="80%" height="1rem" styleClass="mt-2"></p-skeleton>
          <p-skeleton width="60%" height="1rem" styleClass="mt-2"></p-skeleton>
        </p-card>
      }
    </div>
  } @else if (products().length === 0) {
    <div class="no-results">
      <i class="pi pi-inbox" style="font-size: 3rem;"></i>
      <p>No products found</p>
    </div>
  } @else {
    <p-dataView [value]="products()" [layout]="'grid'">
      <ng-template #grid let-items>
        <div class="products-grid">
          <div *ngFor="let product of items" class="product-item">
            <p-card class="product-card">
              <ng-template pTemplate="header">
                @if (product.imageUrl) {
                  <img
                    [src]="product.imageUrl"
                    [alt]="product.title"
                    class="product-image"
                  />
                } @else {
                  <div class="no-image">
                    <i class="pi pi-image" style="font-size: 3rem;"></i>
                  </div>
                }
              </ng-template>

              <div class="product-details">
                <h3 class="product-title">{{ product.title }}</h3>

                @if (product.price) {
                  <div class="product-price">{{ product.price }}</div>
                }

                @if (product.rating) {
                  <div class="product-rating">
                    <i class="pi pi-star-fill"></i>
                    <span>{{ product.rating }}</span>
                  </div>
                }
              </div>

              <ng-template pTemplate="footer">
                <div class="product-actions">
                  @if (product.productUrl) {
                    <a [href]="product.productUrl" target="_blank" rel="noopener noreferrer" class="view-on-amazon">
                      <button pButton type="button" icon="pi pi-external-link" label="Zobacz w Amazon" class="p-button-outlined w-full"></button>
                    </a>
                  }
                  @if (isAuthenticated()) {
                    <button
                      pButton
                      type="button"
                      icon="pi pi-heart"
                      label="Dodaj do ulubionych"
                      class="w-full"
                      (click)="addToFavorites(product)"
                    ></button>
                  }
                </div>
              </ng-template>
            </p-card>
          </div>
        </div>
      </ng-template>
    </p-dataView>
  }
</div>
